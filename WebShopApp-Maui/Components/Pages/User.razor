@page "/user"
@using Microsoft.Maui.Storage
@using Newtonsoft.Json
@using WebShopApp_Maui.Models
@inject NavigationManager navManager

<h3>User Information</h3>

@if (user != null)
{
    <div>
        <p><strong>Name:</strong> @user.Name</p>
        <p><strong>Email:</strong> @user.Email</p>
        <p><strong>Mobile:</strong> @user.Mobile</p>
        <p><strong>Address:</strong> @user.Address</p>
        <p><strong>Roles:</strong> @user.Roles</p>
    </div>
}
else
{
    <p>No user data found. Please <a href="/login">login</a>.</p>
}

@code {
    private UserModel user;

    protected override async Task OnInitializedAsync()
    {
        await LoadUserData();
    }

    private async Task LoadUserData()
    {
        try
        {
            var userJson = await SecureStorage.Default.GetAsync("User");
            if (!string.IsNullOrEmpty(userJson))
            {
                user = JsonConvert.DeserializeObject<UserModel>(userJson);
            }
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error loading user data: {ex.Message}");
            navManager.NavigateTo("/login");
        }
    }
}
